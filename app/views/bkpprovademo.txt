<?php
// Configura√ß√£o de erros
error_reporting(E_ALL);
ini_set('display_errors', 1);
?>
<!DOCTYPE html>
<html lang="pt-br">


<!DOCTYPE html>
<html lang="pt-br">
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulado - SimulaEtec</title>


  <link rel="preload" href="css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="css/style.css">
  </noscript>


  <style>
    @font-face {
      font-family: 'Poppins';
      src: url('<?= HOME_ASSETS ?>fonts/Poppins.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .css-loaded body {
      opacity: 1;
    }
       /* Estilos para o texto das quest√µes */
    .question-text {
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 15px;
    padding: 10px;
    background-color: rgba(255, 255, 255, 0.05);
    border-radius: 5px;
    color: #000000;
    white-space: pre-line;
    margin-left: 60px; /* Espa√ßo para o formul√°rio */
}

  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(function() {
        document.documentElement.classList.add('css-loaded');
      }, 100);

      setTimeout(function() {
        if (!document.documentElement.classList.contains('css-loaded')) {
          document.documentElement.classList.add('css-loaded');
        }
      }, 1000);
    });
  </script>
</head>

<body>


  <header id="topo">
    <div class="header-top">

      <!-- Logo -->
      <div class="header-content">
        <img src="<?= HOME_ASSETS ?>imgs/logo.png" alt="Logo SimulaEtec" class="logo">
        <h3><span class="highlight">SIMULA</span>ETEC</h3>
      </div>


      <nav class="categories-nav">
        <ul class="categories-list">
          <li class="category-item">
            <span class="texto-simulado">Simulado de prova 1¬∫ semestre/2025</span>
          </li>

        </ul>
      </nav>


      <div class="login-container">
       <a href="<?= BASE_URL ?>?page=perfil" class="category-link">Voltar</a>
        <img src="<?= HOME_ASSETS ?>imgs/iconp.png" alt="√çcone de perfil" class="icon-img">
      </div>

    </div>
  </header>
    <div class="timer-box">   
         <div id="timer" class="timer-display animate-onload">00:00:00</div>
    </div>


    <!-- CONTE√öDO PRINCIPAL -->

    <main class="scrollable-content animate-onload" >
  
    <button id="start-btn" class="start-btn">Iniciar Prova</button>

        <section class="post-section" id="questions-container">

        </section>
        <button id="enviar-respostas" class="submit-btn">Enviar Respostas</button>
    </main>

    <footer class="footer">
    <div class="footer-container">
      <div class="footer-bottom">
        <p>¬© 2025 ETEC Itanha√©m. Todos os direitos reservados.</p>
      </div>
  </footer>

<script>
  // ========== CONFIGURA√á√ÉO DOS TEMAS ==========
  const ASSETS_BY_PAGE = {
    'home': "<?= HOME_ASSETS ?>",
    'cadastro': "<?= CADASTRO_ASSETS ?>", 
    'menuprovas': "<?= MENUPROVAS_ASSETS ?>", 
    'prova1': "<?= PROVA1_ASSETS ?>",
    'prova2': "<?= PROVA2_ASSETS ?>", 
    'prova3': "<?= PROVA3_ASSETS ?>",
    'default': "<?= ASSETS_URL ?>"
  };
  
  const temas = {
    "default": "style.css",
    "dark": "darkstyle.css",
    "light": "lightstyle.css"
  };
  
  const temaOrder = ["default", "dark", "light"];
  let currentTemaIndex = 0;

  // ========== FUN√á√ïES DOS TEMAS ==========
  function detectCurrentPage() {
    const urlParams = new URLSearchParams(window.location.search);
    const pageParam = urlParams.get('page') || 'home';
    return pageParam in ASSETS_BY_PAGE ? pageParam : 'default';
  }

  function getSavedTheme() {
    return localStorage.getItem('siteTheme') || 'default';
  }

  function applyTheme(themeName) {
    const currentPage = detectCurrentPage();
    const assetsPath = ASSETS_BY_PAGE[currentPage];
    const themeFile = temas[themeName];
    const fullPath = `${assetsPath}css/${themeFile}`;
    
    let styleElement = document.getElementById('tema-estilo');
    if (!styleElement) {
      styleElement = document.createElement('link');
      styleElement.id = 'tema-estilo';
      styleElement.rel = 'stylesheet';
      document.head.appendChild(styleElement);
    }
    
    if (styleElement.href !== fullPath) {
      styleElement.onload = () => {
        // Dispara evento ap√≥s o CSS carregar
        document.dispatchEvent(new CustomEvent('themeChanged'));
      };
      styleElement.href = fullPath;
    }
    
    localStorage.setItem('siteTheme', themeName);
    currentTemaIndex = temaOrder.indexOf(themeName);
  }

  function trocarEstilo() {
    if (detectCurrentPage() === 'home') {
      currentTemaIndex = (currentTemaIndex + 1) % temaOrder.length;
      const nextTheme = temaOrder[currentTemaIndex];
      applyTheme(nextTheme);
      
      if (typeof BroadcastChannel !== 'undefined') {
        const channel = new BroadcastChannel('theme_channel');
        channel.postMessage({ type: 'themeChanged', theme: nextTheme });
      }
    }
  }

  // ========== SCROLL REVEAL ==========
  function setupScrollReveal() {
    const elements = document.querySelectorAll(".scroll-reveal");
    let lastScrollTop = window.scrollY;

    function revealOnScroll() {
      const currentScrollTop = window.scrollY;
      const windowHeight = window.innerHeight;
      const middleScreen = windowHeight / 2;

      elements.forEach((element) => {
        const elementTop = element.getBoundingClientRect().top;
        const elementBottom = element.getBoundingClientRect().bottom;

        if (elementTop < middleScreen && elementBottom > middleScreen) {
          element.classList.add("show");
        } else if (currentScrollTop < lastScrollTop) {
          element.classList.remove("show");
        }
      });

      lastScrollTop = currentScrollTop;
    }

    window.addEventListener("scroll", revealOnScroll);
    revealOnScroll();
  }

 
  // ========== INICIALIZA√á√ÉO ==========
  document.addEventListener("DOMContentLoaded", function() {
    // 1. Aplica o tema primeiro (s√≠ncrono)
    applyTheme(getSavedTheme());

    // 2. Configura os outros efeitos ap√≥s pequeno delay
    setTimeout(() => {
      setupScrollReveal();
    }, 50);

    // Sincroniza√ß√£o entre abas
    if (typeof BroadcastChannel !== 'undefined') {
      const channel = new BroadcastChannel('theme_channel');
      channel.addEventListener('message', (event) => {
        if (event.data.type === 'themeChanged') {
          applyTheme(event.data.theme);
        }
      });
    }

    window.addEventListener('storage', function(event) {
      if (event.key === 'siteTheme') {
        applyTheme(event.newValue);
      }
    });
  });

  // Evento para quando o tema terminar de carregar
  document.addEventListener('themeChanged', () => {
    // For√ßa atualiza√ß√£o do scroll reveal ap√≥s mudan√ßa de tema
    if (typeof setupScrollReveal === 'function') {
      setupScrollReveal();
    }
  });
</script>



  <script>
        document.addEventListener('DOMContentLoaded', function() {
            const config = window.SIMULAETEC_CONFIG || {};
            const PROVADEMO_ASSETS = config.PROVADEMO_ASSETS || '';

            const questionsContainer = document.getElementById('questions-container');
            const submitBtn = document.getElementById('enviar-respostas');
            const startBtn = document.getElementById('start-btn');
            const timerDisplay = document.getElementById('timer');

            // Lista de quest√µes 
            const questions = [
                { 
                    text: `Antes de iniciar a prova, leia atentamente as instru√ß√µes a seguir e aguarde a ordem do Fiscal para iniciar o Exame.
                        1. Este caderno cont√©m 50 (cinquenta) quest√µes em forma de teste.
                        2. A prova ter√° dura√ß√£o de 4 (quatro) horas.
                        3. Ap√≥s o in√≠cio do Exame, voc√™ dever√° permanecer no m√≠nimo at√© √†s 15h30min dentro da sala do Exame, podendo, ao deixar este local, levar consigo o caderno de quest√µes.
                        4. Voc√™ receber√° do Fiscal a Folha de Respostas Definitiva. Verifique se est√° em ordem e com todos os dados impressos corretamente. Caso contr√°rio, notifique o Fiscal, imediatamente.
                        5. Ap√≥s certificar-se de que a Folha de Respostas Definitiva √© sua, assine-a com caneta esferogr√°fica de tinta preta ou azul no local em que h√° a indica√ß√£o: "ASSINATURA DO(A) CANDIDATO(A)".
                        6. Ap√≥s o recebimento da Folha de Respostas Definitiva, n√£o a dobre e nem a amasse, manipulando-a o m√≠nimo poss√≠vel.
                        7. Cada quest√£o cont√©m 5 (cinquenta) alternativas (A, B, C, D, E) das quais somente uma atende √†s condi√ß√µes do enunciado.`,
                    requiresAnswer: false 
                },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/intro.png',
                     requiresAnswer: false 
                    }, 
                { 
                 text:`Quest√£o 01
                    As plantas proporcionam uma infinidade de benef√≠cios que s√£o essenciais para a manuten√ß√£o da vida na
                    Terra, como a produ√ß√£o de alimentos e de oxig√™nio. Al√©m disso, s√£o fontes de mat√©ria-prima para a ind√∫stria,
                    uma vez que s√£o utilizadas para a produ√ß√£o de biocombust√≠veis e de rem√©dios.
                    Outro papel fundamental das plantas √© o controle da din√¢mica da √°gua na Terra e da temperatura do planeta.
                    Compreender suas fun√ß√µes vitais √© importante para promover esfor√ßos de conserva√ß√£o do meio ambiente.
                    Em rela√ß√£o ao cultivo de plantas, uma a√ß√£o que devemos adotar √©
                    (A)	 evitar adubar a terra, a fim de impedir o excesso de nutrientes t√≥xicos e a prolifera√ß√£o tanto de pragas
                    quanto de plantas daninhas.
                    (B)	 permitir que lesmas e caramujos cres√ßam entre as plantas, a fim de estimular a poliniza√ß√£o das flores
                    e a forma√ß√£o dos frutos.
                    (C)	 utilizar a quantidade certa de √°gua para cada tipo de planta, a fim de impedir que o solo fique encharcado
                    e as ra√≠zes n√£o consigam respirar.
                    (D)	 evitar o uso de qualquer tipo de controle biol√≥gico, a fim de impedir a prolifera√ß√£o de pragas
                    e insetos transmissores de doen√ßas.
                    (E)	 optar por locais bem ventilados, a fim de impedir a evapora√ß√£o da √°gua do solo, o que facilita
                    a condu√ß√£o de seiva pelos vasos das plantas.`,
                    requiresAnswer: true 
                },
                { 
                 text:`Quest√£o 02 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 03 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 04 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 05 cole o texto aqui`,
                    requiresAnswer: true 
                },
               { 
                 text:`Quest√£o 06 cole o texto aqui`,
                    requiresAnswer: true 
                },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest7img.png', requiresAnswer: false },
                { 
                 text:`Quest√£o 07 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 08 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 09 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 10 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 11 cole o texto aqui`,
                    requiresAnswer: true 
                },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest12a15img.png', requiresAnswer: false },
                  { 
                 text:`Quest√£o 12 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 13 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 14 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 15 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 16 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 17 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 18 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 19 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 20 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 21 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 22 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 23 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 24 cole o texto aqui`,
                    requiresAnswer: true 
                },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest25a26img.png', requiresAnswer: false },
                 { 
                 text:`Quest√£o 25 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 26 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 27 cole o texto aqui`,
                    requiresAnswer: true 
                },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest28a29img.png', requiresAnswer: false },
                 { 
                 text:`Quest√£o 28 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 29 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 30 cole o texto aqui`,
                    requiresAnswer: true 
                },
                 { 
                 text:`Quest√£o 31 cole o texto aqui`,
                    requiresAnswer: true 
                },
                  { 
                 text:`Quest√£o 32 cole o texto aqui`,
                    requiresAnswer: true 
                },
                
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest33.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest34.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest35a36img.png', requiresAnswer: false },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest35.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest36.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest37.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest38.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest39a42img.png', requiresAnswer: false },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest39.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest40.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest41.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest42.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest43.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest44.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest45.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest46a49img.png', requiresAnswer: false },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest46.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest47.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest48.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest49.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/quest50.png', requiresAnswer: true },
                { image: PROVADEMO_ASSETS + '<?= PROVADEMO_ASSETS ?>imgs/imgprovas/gabarito.png', requiresAnswer: false }
        
            ];

            // Classe Timer
            class Timer {
                constructor(displayElement) {
                    this.display = displayElement;
                    this.totalTime = 14400; // 4 horas em segundos (60*60*4)
                    this.initialTime = this.totalTime;
                    this.interval = null;
                    this.timeExpired = false;
                }
                
                start() {
                    if (!this.interval) {
                        this.interval = setInterval(() => this.update(), 1000);
                    }
                }
                
                stop() {
                    clearInterval(this.interval);
                    this.interval = null;
                }
                
                update() {
                    const hours = Math.floor(this.totalTime / 3600);
                    const minutes = Math.floor((this.totalTime % 3600) / 60);
                    const seconds = this.totalTime % 60;
                    
                    this.display.textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Atualiza a cor conforme o tempo restante
                    const percentage = this.totalTime / this.initialTime;
                    
                    if (percentage <= 0.1) {
                        this.display.style.color = "red";
                    } else if (percentage <= 0.5) {
                        this.display.style.color = "yellow";
                    } else {
                        this.display.style.color = "green";
                    }
                    
                    // Verifica se o tempo acabou
                    if (this.totalTime <= 0 && !this.timeExpired) {
                        this.timeExpired = true;
                        this.stop();
                        this.display.textContent = "Tempo excedido";
                        this.display.style.color = "red";
                        // Aqui voc√™ pode adicionar outras a√ß√µes quando o tempo acabar
                    } else {
                        this.totalTime--;
                    }
                }
                
                reset() {
                    this.stop();
                    this.totalTime = this.initialTime;
                    this.timeExpired = false;
                    this.display.style.color = "green";
                    this.update();
                }
            }

            // Classe para criar quest√µes (modificada para usar texto)
            class QuestionBuilder {
                constructor(questions) {
                    this.questions = questions;
                }

                buildQuestions(container) {
                    this.questions.forEach((question, index) => {
                        const questaoNumero = index + 1;

                        const article = document.createElement('article');
                        article.classList.add('post');
                        article.dataset.questao = questaoNumero;

                        const postContent = document.createElement('div');
                        postContent.classList.add('post-content');

                        // Substituindo a imagem por texto
                        const textElement = document.createElement('p');
                        textElement.classList.add('question-text');
                        textElement.textContent = question.text;
                        postContent.appendChild(textElement);

                        article.appendChild(postContent);

                        if (question.requiresAnswer) {
                            const answerSection = document.createElement('div');
                            answerSection.classList.add('answer-section');

                            const form = document.createElement('form');
                            form.id = `form-questao-${questaoNumero}`;
                            form.classList.add('alternative-answers');

                            const options = ['A', 'B', 'C', 'D', 'E'];

                            options.forEach((option) => {
                                const answerOption = document.createElement('div');
                                answerOption.classList.add('answer-option');

                                const input = document.createElement('input');
                                input.type = 'radio';
                                input.id = `option-${option.toLowerCase()}-${questaoNumero}`;
                                input.name = `answer-${questaoNumero}`;
                                input.value = option;

                                const label = document.createElement('label');
                                label.setAttribute('for', input.id);
                                label.textContent = `(${option})`;

                                answerOption.appendChild(input);
                                answerOption.appendChild(label);

                                form.appendChild(answerOption);
                            });

                            answerSection.appendChild(form);
                            article.appendChild(answerSection);
                        }

                        container.appendChild(article);
                    });
                }

                renderAllQuestions(container) {
                    this.buildQuestions(container);
                }
            }



    // Classe para gerenciar o simulado
    class SimuladoManager {
        constructor(questions, container, submitButton, startButton, timer) {
            this.questions = questions;
            this.container = container;
            this.submitButton = submitButton;
            this.startButton = startButton;
            this.timer = timer;
            this.questionBuilder = new QuestionBuilder(questions);
            this.respostas = [];
            this.started = false;
        }

        init() {
            // Mostra apenas a primeira quest√£o inicialmente
            this.renderFirstQuestionOnly();
            this.setupEventListeners();
        }

        renderFirstQuestionOnly() {
            // Limpa o container
            this.container.innerHTML = '';
            
            // Cria apenas a primeira quest√£o
            const firstQuestion = [this.questions[0]];
            const tempBuilder = new QuestionBuilder(firstQuestion);
            tempBuilder.buildQuestions(this.container);
            
            // Esconde o bot√£o de enviar respostas inicialmente
            this.submitButton.style.display = 'none';
        }

        startSimulado() {
            if (this.started) return;
            
            this.started = true;
            
            // Esconde o bot√£o de iniciar
            this.startButton.style.display = 'none';
            
            // Mostra o bot√£o de enviar respostas
            this.submitButton.style.display = 'block';
            
            // Renderiza todas as quest√µes
            this.container.innerHTML = '';
            this.questionBuilder.renderAllQuestions(this.container);
            
            // Inicia o timer
            this.timer.start();
        }

        setupEventListeners() {
            this.submitButton.addEventListener('click', () => this.processarRespostas());
            this.startButton.addEventListener('click', () => this.startSimulado());
        }

processarRespostas() {
    this.respostas = [];
    let questaoRealNumero = 1;
    let algumaNaoRespondida = false;

    this.questions.forEach((question, indexOriginal) => {
        if (question.requiresAnswer) {
            const formId = `form-questao-${indexOriginal + 1}`;
            const form = document.getElementById(formId);

            let resposta = '';
            if (form) {
                const checkedInput = form.querySelector('input[type="radio"]:checked');
                resposta = checkedInput ? checkedInput.value : resposta;
            }

            if (resposta === '') {
                algumaNaoRespondida = true;
            }

            this.respostas.push({
                questao: questaoRealNumero,
                resposta: resposta
            });

            questaoRealNumero++;
        }
    });
    

    if (algumaNaoRespondida) {
        alert('Por favor, responda todas as quest√µes antes de enviar.');
        return; // interrompe o envio
    }

    // Envia as respostas e trata a resposta da API
    fetch('index.php?page=salvar_desempenho_prova1', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            tempo_restante: this.timer.totalTime,
            respostas: this.respostas
        })
    })
    .then(async response => {
        const text = await response.text();
        try {
            const json = JSON.parse(text);
            alert(json.message);

            if (json.success) {
                this.submitButton.disabled = true;
this.submitButton.textContent = "Respostas Enviadas";
this.submitButton.style.opacity = "0.6";

                // Montar o relat√≥rio
                let relatorio = "===== RELAT√ìRIO DO SIMULADO =====\n";
                relatorio += `Semestre: 1¬∫ semestre/2025\n`;
                relatorio += `Acertos: ${json.correcao.filter(c => c.acertou).length}\n`;
                relatorio += `Erros: ${json.correcao.filter(c => !c.acertou).length}\n`;
                relatorio += "---------------------------------\n";
                relatorio += "Quest√£o | Resposta Usu√°rio | Resposta Correta | Acertou\n";

                json.correcao.forEach(item => {
                    relatorio += `${item.questao}       | ${item.resposta_usuario}               | ${item.resposta_correta}               | ${item.acertou ? 'Sim' : 'N√£o'}\n`;
                });
                // Mostrar na tela (voc√™ pode ter uma <pre id="relatorio-container"></pre>)
let container = document.getElementById("relatorio-container");
if (!container) {
    container = document.createElement("pre");
    container.id = "relatorio-container";

    // ESTILIZA√á√ÉO
    container.style.color = "black";
    container.style.backgroundColor = "#fff";
    container.style.padding = "10px";
    container.style.borderRadius = "5px";

    const submitBtn = document.getElementById('enviar-respostas');
    submitBtn.insertAdjacentElement('afterend', container);
}

if (!container) {
    container = document.createElement("pre");
    container.id = "relatorio-container";
    // Inserir logo ap√≥s o bot√£o "Enviar Respostas"
    const submitBtn = document.getElementById('enviar-respostas');
    submitBtn.insertAdjacentElement('afterend', container);
}
container.textContent = relatorio;


// Criar link para baixar .txt
const blob = new Blob([relatorio], { type: "text/plain" });
const link = document.createElement("a");
link.href = URL.createObjectURL(blob);
link.download = `relatorio_simulado_${Date.now()}.txt`;
link.textContent = "üìÑ Baixar relat√≥rio em .txt";
link.style.display = "block";

// Adiciona link depois do relat√≥rio
container.insertAdjacentElement('afterend', link);

            }
        } catch (e) {
            console.error("Erro ao converter JSON:", e);
            alert("Erro no servidor. Veja o console.");
        }
    })
    .catch(error => {
        console.error('Erro ao enviar respostas:', error);
        alert("Erro ao enviar respostas.");
    });

    // Imprime no console de forma organizada
    console.log("========= RESPOSTAS DO USU√ÅRIO =========");
    console.log(`Total de quest√µes: ${this.respostas.length}`);
    console.log("-----------------------------------------");

    this.respostas.forEach(item => {
        console.log(`Quest√£o ${item.questao}: ${item.resposta}`);
    });

    console.log("=========================================");
}


}

    // Inicializa o simulado
    const timer = new Timer(timerDisplay);
    const simulado = new SimuladoManager(
        questions, 
        questionsContainer, 
        submitBtn, 
        startBtn,
        timer
    );
    simulado.init();
});

</script>


</body>
</html>